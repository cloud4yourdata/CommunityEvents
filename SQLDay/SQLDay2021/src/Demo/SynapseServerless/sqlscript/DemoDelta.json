{
	"name": "DemoDelta",
	"properties": {
		"folder": {
			"name": "SQLDay2020Demo"
		},
		"content": {
			"query": "CREATE DATABASE SqlDay2020Demo;\nUSE SqlDay2020Demo;\n\n----\nSELECT r.filename() AS DetlaFileName,\n    *\nFROM\n    OPENROWSET(\n        BULK 'abfss://datalake@datalake2demos.dfs.core.windows.net/analytics_zone/DWHS/DeltaDWH/dimuser/',\n        FORMAT='PARQUET'\n    ) AS [r]\n\nWHERE UserId = 0 \n---\n--GO TO SPARK Demo003 -Show Delta https://github.com/FP-DataSolutions/SQLDay2020/blob/main/Demos/DeltaFormat.md\n\n\n\nWITH dataFileNames AS\n(\n    SELECT REPLACE(f.C1,'abfss://datalake@datalake2demos.dfs.core.windows.net/analytics_zone/DWHS/DeltaDWH/dimuser/','') AS fileName FROM \n  OPENROWSET(\n        BULK 'abfss://datalake@datalake2demos.dfs.core.windows.net/analytics_zone/DWHS/DeltaDWH/dimuser/_symlink_format_manifest/manifest',\n        FORMAT='CSV',\n        PARSER_VERSION = '2.0',\n        firstrow = 0\n  ) AS f\n)\nSELECT *,\n    UserKey, UserId, UserRole,row_iscurrent AS IsCurrent,  row_startdate AS StartDate,row_enddate AS EndDate\nFROM\n    OPENROWSET(\n        BULK 'abfss://datalake@datalake2demos.dfs.core.windows.net/analytics_zone/DWHS/DeltaDWH/dimuser/',\n        FORMAT='PARQUET'\n    ) AS [r]\nWHERE r.filename() IN \n    (SELECT f.fileName FROM dataFileNames AS f )\nAND UserId = 0 \n\n--DROP VIEW IF EXISTS dbo.vmDimDate ;\n-----------------------------------------------------------------CREATE VIEWS\nDROP VIEW IF EXISTS dbo.vwDimUser ;\nGO\nCREATE  VIEW dbo.vwDimUser AS \nWITH dataFileNames AS\n(\n    SELECT REPLACE(f.C1,'abfss://datalake@datalake2demos.dfs.core.windows.net/analytics_zone/DWHS/DeltaDWH/dimuser/','') AS fileName FROM \n  OPENROWSET(\n        BULK 'https://datalake2demos.dfs.core.windows.net/datalake/analytics_zone/DWHS/DeltaDWH/dimuser/_symlink_format_manifest/manifest',\n        FORMAT='CSV',\n        PARSER_VERSION = '2.0',\n        firstrow = 0\n  ) AS f\n)\nSELECT\n     UserKey, UserId, UserName, UserRole,row_iscurrent AS IsCurrent,  row_startdate AS StartDate,row_enddate AS EndDate\nFROM\n    OPENROWSET(\n        BULK 'https://datalake2demos.dfs.core.windows.net/datalake/analytics_zone/DWHS/DeltaDWH/dimuser/',\n        FORMAT='PARQUET'\n    ) AS [r]\nWHERE r.filename() IN \n    (SELECT f.fileName FROM dataFileNames AS f )\n\nGO\nDROP VIEW IF EXISTS dbo.vwDimDate ;\nGO\nCREATE  VIEW dbo.vwDimDate AS \nWITH dataFileNames AS\n(\n    SELECT REPLACE(f.C1,'abfss://datalake@datalake2demos.dfs.core.windows.net/analytics_zone/DWHS/DeltaDWH/dimdate/','') AS fileName FROM \n  OPENROWSET(\n        BULK 'https://datalake2demos.dfs.core.windows.net/datalake/analytics_zone/DWHS/DeltaDWH/dimdate/_symlink_format_manifest/manifest',\n        FORMAT='CSV',\n        PARSER_VERSION = '2.0',\n        firstrow = 0\n  ) AS f\n)\nSELECT\n     *\nFROM\n    OPENROWSET(\n        BULK 'https://datalake2demos.dfs.core.windows.net/datalake/analytics_zone/DWHS/DeltaDWH/dimdate/',\n        FORMAT='PARQUET'\n    ) AS [r]\nWHERE r.filename() IN \n    (SELECT f.fileName FROM dataFileNames AS f )\n\nGO\n\nDROP VIEW IF EXISTS dbo.vwDimTaskDetails ;\nGO\nCREATE  VIEW dbo.vwDimTaskDetails AS \nWITH dataFileNames AS\n(\n    SELECT REPLACE(f.C1,'abfss://datalake@datalake2demos.dfs.core.windows.net/analytics_zone/DWHS/DeltaDWH/dimtaskdetails/','') AS fileName FROM \n  OPENROWSET(\n        BULK 'https://datalake2demos.dfs.core.windows.net/datalake/analytics_zone/DWHS/DeltaDWH/dimtaskdetails/_symlink_format_manifest/manifest',\n        FORMAT='CSV',\n        PARSER_VERSION = '2.0',\n        firstrow = 0\n  ) AS f\n)\nSELECT\n     TaskDetailsKey, TaskId, Details,row_iscurrent AS IsCurrent,  row_startdate AS StartDate,row_enddate AS EndDate\nFROM\n    OPENROWSET(\n        BULK 'https://datalake2demos.dfs.core.windows.net/datalake/analytics_zone/DWHS/DeltaDWH/dimtaskdetails/',\n        FORMAT='PARQUET'\n    ) AS [r]\nWHERE r.filename() IN \n    (SELECT f.fileName FROM dataFileNames AS f )\n\n\nDROP VIEW IF EXISTS dbo.vwFactTask ;\nGO\nCREATE  VIEW dbo.vwFactTask AS \nWITH dataFileNames AS\n(\n    SELECT REPLACE(f.C1,'abfss://datalake@datalake2demos.dfs.core.windows.net/analytics_zone/DWHS/DeltaDWH/facttask/','') AS fileName FROM \n  OPENROWSET(\n        BULK 'https://datalake2demos.dfs.core.windows.net/datalake/analytics_zone/DWHS/DeltaDWH/facttask/_symlink_format_manifest/',\n        FORMAT='CSV',\n        PARSER_VERSION = '2.0',\n        firstrow = 0\n  ) AS f\n)\nSELECT\n     TaskKey, DateKey,UserKey,TaskDetailsKey\nFROM\n    OPENROWSET(\n        BULK 'https://datalake2demos.dfs.core.windows.net/datalake/analytics_zone/DWHS/DeltaDWH/facttask/',\n        FORMAT='PARQUET'\n    ) AS [r]\nWHERE r.filename() IN \n    (SELECT f.fileName FROM dataFileNames AS f )\n\n\n\n\n\n\n\n\n\n\n\n\n\n",
			"metadata": {
				"language": "sql"
			},
			"currentConnection": {
				"poolName": "Built-in",
				"databaseName": "SqlDay2020Demo"
			}
		},
		"type": "SqlQuery"
	}
}