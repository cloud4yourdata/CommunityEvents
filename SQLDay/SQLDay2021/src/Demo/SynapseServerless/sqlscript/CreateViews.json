{
	"name": "CreateViews",
	"properties": {
		"folder": {
			"name": "SQLDay2020DemoFinal"
		},
		"content": {
			"query": "USE SqlDay2020DemoFinal;\n\nDROP VIEW IF EXISTS dbo.vwDimUser ;\nGO\nCREATE  VIEW dbo.vwDimUser AS \nWITH dataFileNames AS\n(\n    SELECT REPLACE(f.C1,'abfss://datalake@datalake2demos.dfs.core.windows.net/analytics_zone/DWHS/DeltaDWHFinal/dimuser/','') AS fileName FROM \n  OPENROWSET(\n        BULK 'https://datalake2demos.dfs.core.windows.net/datalake/analytics_zone/DWHS/DeltaDWHFinal/dimuser/_symlink_format_manifest/manifest',\n        FORMAT='CSV',\n        PARSER_VERSION = '2.0',\n        firstrow = 0\n  ) AS f\n)\nSELECT\n     UserKey, UserId, UserName, UserRole,row_iscurrent AS IsCurrent,  row_startdate AS StartDate,row_enddate AS EndDate\nFROM\n    OPENROWSET(\n        BULK 'https://datalake2demos.dfs.core.windows.net/datalake/analytics_zone/DWHS/DeltaDWHFinal/dimuser/',\n        FORMAT='PARQUET'\n    ) AS [r]\nWHERE r.filename() IN \n    (SELECT f.fileName FROM dataFileNames AS f )\n\nGO\nDROP VIEW IF EXISTS dbo.vwDimDate ;\nGO\nCREATE  VIEW dbo.vwDimDate AS \nWITH dataFileNames AS\n(\n    SELECT REPLACE(f.C1,'abfss://datalake@datalake2demos.dfs.core.windows.net/analytics_zone/DWHS/DeltaDWHFinal/dimdate/','') AS fileName FROM \n  OPENROWSET(\n        BULK 'https://datalake2demos.dfs.core.windows.net/datalake/analytics_zone/DWHS/DeltaDWHFinal/dimdate/_symlink_format_manifest/manifest',\n        FORMAT='CSV',\n        PARSER_VERSION = '2.0',\n        firstrow = 0\n  ) AS f\n)\nSELECT\n     *\nFROM\n    OPENROWSET(\n        BULK 'https://datalake2demos.dfs.core.windows.net/datalake/analytics_zone/DWHS/DeltaDWHFinal/dimdate/',\n        FORMAT='PARQUET'\n    ) AS [r]\nWHERE r.filename() IN \n    (SELECT f.fileName FROM dataFileNames AS f )\n\nGO\n\nDROP VIEW IF EXISTS dbo.vwDimTaskDetails ;\nGO\nCREATE  VIEW dbo.vwDimTaskDetails AS \nWITH dataFileNames AS\n(\n    SELECT REPLACE(f.C1,'abfss://datalake@datalake2demos.dfs.core.windows.net/analytics_zone/DWHS/DeltaDWHFinal/dimtaskdetails/','') AS fileName FROM \n  OPENROWSET(\n        BULK 'https://datalake2demos.dfs.core.windows.net/datalake/analytics_zone/DWHS/DeltaDWHFinal/dimtaskdetails/_symlink_format_manifest/manifest',\n        FORMAT='CSV',\n        PARSER_VERSION = '2.0',\n        firstrow = 0\n  ) AS f\n)\nSELECT\n     TaskDetailsKey, TaskId, Details,row_iscurrent AS IsCurrent,  row_startdate AS StartDate,row_enddate AS EndDate\nFROM\n    OPENROWSET(\n        BULK 'https://datalake2demos.dfs.core.windows.net/datalake/analytics_zone/DWHS/DeltaDWHFinal/dimtaskdetails/',\n        FORMAT='PARQUET'\n    ) AS [r]\nWHERE r.filename() IN \n    (SELECT f.fileName FROM dataFileNames AS f )\n\n\nDROP VIEW IF EXISTS dbo.vwFactTask ;\nGO\nCREATE  VIEW dbo.vwFactTask AS \nWITH dataFileNames AS\n(\n    SELECT REPLACE(f.C1,'abfss://datalake@datalake2demos.dfs.core.windows.net/analytics_zone/DWHS/DeltaDWHFinal/facttask/','') AS fileName FROM \n  OPENROWSET(\n        BULK 'https://datalake2demos.dfs.core.windows.net/datalake/analytics_zone/DWHS/DeltaDWHFinal/facttask/_symlink_format_manifest/',\n        FORMAT='CSV',\n        PARSER_VERSION = '2.0',\n        firstrow = 0\n  ) AS f\n)\nSELECT\n     TaskKey, DateKey,UserKey,TaskDetailsKey\nFROM\n    OPENROWSET(\n        BULK 'https://datalake2demos.dfs.core.windows.net/datalake/analytics_zone/DWHS/DeltaDWHFinal/facttask/',\n        FORMAT='PARQUET'\n    ) AS [r]\nWHERE r.filename() IN \n    (SELECT f.fileName FROM dataFileNames AS f )\n",
			"metadata": {
				"language": "sql"
			},
			"currentConnection": {
				"name": "SqlDay2020DemoFinal",
				"type": "SqlOnDemand"
			}
		},
		"type": "SqlQuery"
	}
}