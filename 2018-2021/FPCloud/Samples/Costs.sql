USE FPCLOUD;
USE WAREHOUSE MYLAB_DW;
USE ROLE ACCOUNTADMIN;
USE SCHEMA STAGE;

CREATE OR REPLACE VIEW UTIL_DB.PUBLIC.VW_SF_WAREHOUSE_METERING_HISTORY
AS
SELECT 
  START_TIME,
  END_TIME,
  WAREHOUSE_ID,
  WAREHOUSE_NAME,
  CREDITS_USED,
  TO_DATE(START_TIME) AS START_DATE,
  DATEDIFF(HOUR, START_TIME, END_TIME) AS WAREHOUSE_OPERATION_HOURS,
  HOUR(START_TIME) AS TIME_OF_DAY
FROM SNOWFLAKE.ACCOUNT_USAGE.WAREHOUSE_METERING_HISTORY;


SELECT 400 - SUM(CREDITS_USED) AS CREDITS_LEFT FROM UTIL_DB.PUBLIC.VW_SF_WAREHOUSE_METERING_HISTORY;